进程：是 cpu 资源分配的最小单位  
线程：是 cpu 调度的最小单位

## 多进程的浏览器

浏览器是多进程的，有一个主控进程，每一个 tab 页面就会新开一个进程（某些情况下多个 tab 会合并进程）

- Browser 进程：浏览器的主进程（负责协调、主控），只有一个
  - 负责浏览器界面显示，与用户交互，如前进、后退等
  - 负责各个页面的管理，创建和销毁其他进程
  - 将 Renderer 进程得到的内存中的 Bitmap 绘制到用户界面上
  - 网络资源的管理、下载等
- GPU 进程：最多一个，用于 3D 绘制
- Renderer 进程，浏览器渲染进程 （内核）：默认每个 tab 页面一个进程，互不影响，控制页面渲染、脚本执行、事件处理等（有时会优化，比如多个空白 tab 合并成一个进程）
- 第三方插件进程：每种类型的插件对应一个进程，使用插件时才被创建

### 浏览器渲染进程内核

浏览器渲染进程是多线程的

- GUI 渲染线程
  - 渲染浏览器界面，解析 HTML、CSS，构建 DOM 树和 RenderObject 树，布局和绘制等
  - 当界面需要重绘（Repaint）或由于某种操作引发回流（reflow）时，该线程就会执行
  - **GUI 线程与 JS 引擎线程是互斥的**，当 JS 引擎执行时，GUI 渲染线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中**等到 JS 引擎空闲时立即被执行**
- JS 引擎线程
  - 也成为 JS 内核，负责处理 JavaScript 脚本程序（例如 V8 引擎）
  - 负责解析 JavaScript 脚本，运行代码
  - 一直等待着任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer 进程）中无论什么时候都只有一个 JS 线程在运行 JS 代码
  - 如果 JS 执行的时间过长就会造成页面渲染不连贯，导致页面渲染加载阻塞
- 事件触发线程
  - 归属于浏览器而不是 JS 引擎，用来控制事件循环
  - 当 JS 引擎执行代码块如 setTimeOut 时（也可以来自其他线程，如鼠标点击事件、AJAX 异步请求等），会将对应任务添加到事件线程中
  - 当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待 JS 引擎的处理
  - 由于 JS 的单线程关系，所以这些待处理队列中的事件都得排队等待 JS 引擎处理（当 JS 引擎空闲时执行）
- 定时器线程
  - setTiterval 与 setTimeout 所在线程
  - 浏览器定时计数器不是由 JS 引擎计数的，因为 JS 引擎是单线程的，如果处于阻塞线程状态会影响计时器的准确
  - 计时完毕后添加到事件队列中，等待 JS 引擎空闲后执行
  - W3C 规定，setTimeout 中低于 4ms 的时间间隔酸味 4ms
- 网络请求线程
  - XMLHTTPRequest 是浏览器通过新开一个线程请求的
  - 检测到状态变更时，如果有回调函数，一步线程就产生状态变更事件，并将这个回调放入事件队列中，由 JS 引擎空闲时执行
  - URL 解析到 http 协议就会新建一个网络线程去处理资源下载
